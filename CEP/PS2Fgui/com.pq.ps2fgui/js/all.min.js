!function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),n=i(2),a=i(4),o=window||{},s=new n.default,d=s.getCSInterface();o.batchExport=function(){var t=cep.fs.showOpenDialog(!1,!0,"选择切图导出目录","D:/"),e=t.data[0];e&&d.evalScript("batchExport('"+e+"');")},o.packageExport=function(){var t=cep.fs.showOpenDialog(!1,!0,"选择fairygui导出目录","D:/"),e=t.data[0],i=e+"/"+r.AppConfig.pckName+r.AppConfig.resPath,n=i.substr(0,i.length-1);if(e){a.default.createDir(e+"/"+r.AppConfig.pckName),a.default.createDir(n);var o="packageExport('"+e+"','"+n+"');";d.evalScript(o)}},o.clickTest=function(){d.evalScript("test();")}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AppConfig={pckName:"test",viewName:"TestView",resPath:"/image/",comPath:"/com/"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),n=i(3),a=i(4),o=function(){function t(){this.init()}return t.prototype.getCSInterface=function(){return this._csInterface},t.prototype.init=function(){var t=new CSInterface;this._csInterface=t,this.addListerCEPEvent(),a.default.loadJSX(t,"lib/json2.jsx"),a.default.loadJSX(t,"utils.jsx"),a.default.loadJSX(t,"batch.jsx"),a.default.loadJSX(t,"package.jsx"),a.default.loadJSX(t,"test.jsx")},t.prototype.addListerCEPEvent=function(){this._csInterface.addEventListener("psd_layer_data",this.packageLyaerDeal)},t.prototype.packageLyaerDeal=function(t){n.parseLayerData(t.data,r.AppConfig.pckName)},t}();e.default=o},function(t,e,i){"use strict";function r(t,e){p=null;var i=h.default.genBuildId();l=t.path+"/"+f.AppConfig.pckName,c=new g.default(l,i,e);var r=t.layers;n(f.AppConfig.viewName,r,l+"/",d(t.document)),c.addComponent(f.AppConfig.viewName+".xml","/");var a=l+"/package.xml",o=c.getString();cep.fs.writeFile(a,o),alert("导出package成功！")}function n(t,e,i,r){var m=new _.default,g=u(r);m.setSize(g.width,g.height),p||(p=m);var y,v;for(var I in e)if(Object.hasOwnProperty.call(e,I)){v=e[I];var b=d(v);if(y=u(b),a(I,v),v.kind){var x=o(I,v,m);x.addAtt("xy",y.x+","+y.y),x.addAtt("size",y.width+","+y.height)}else{c.addComponent(I+".xml",f.AppConfig.comPath);var A=s(I,p);A.addAtt("xy",y.x+","+y.y),A.addAtt("size",y.width+","+y.height),n(I,v.layers,""+l+f.AppConfig.comPath,d(v))}}h.default.createDir(""+i);var M=""+i+t+".xml",S=m.getString();cep.fs.writeFile(M,S)}function a(t,e){"image"===e.kind&&c.addImage(t+".png",f.AppConfig.resPath)}function o(t,e,i){var r,n=e.kind;if(n)switch(n){case"image":r=m.default.createXMLItem("image");var a=t+".png",o=c.getAttsByKeyAndValue("name",a);r.addAtt("id","n"+i.displayNum+"_"+c.itemIdBase),r.addAtt("fileName","image/"+t+".png"),r.addAtt("name",""+t),r.addAtt("src",""+o.id);break;case"text":r=m.default.createXMLItem("text"),r.addAtt("id","n"+i.displayNum+"_"+c.itemIdBase),r.addAtt("name",""+t),r.addAtt("fontSize","24"),r.addAtt("text",t);break;default:alert("存在未处理的类型kind: "+n)}return r&&i.addDisplayItem(r),r}function s(t,e){var i=m.default.createXMLItem("component"),r=c.getComponent(t+".xml");return i.addAtt("id","n"+e.displayNum+"_"+c.itemIdBase),i.addAtt("name",""+t),i.addAtt("src",""+r.getAtt("id")),i&&e.addDisplayItem(i),i}function d(t){if(t.kind)return t.bounds;var e=void 0,i=t.layers;for(var r in i)if(Object.hasOwnProperty.call(i,r)){var n=i[r].bounds;e?(e[0]=Math.min(e[0],n[0]),e[1]=Math.min(e[1],n[1]),e[2]=Math.max(e[2],n[2]),e[3]=Math.max(e[3],n[3])):e=n}return e}function u(t){var e=t[2]-t[0],i=t[3]-t[1],r=t[0],n=t[1],a={x:r,y:n,width:e,height:i};return a}Object.defineProperty(e,"__esModule",{value:!0});var c,l,p,f=i(1),h=i(4),m=i(5),_=i(9),g=i(10);e.parseLayerData=r},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.loadJSX=function(t,e){var i=t.getSystemPath(SystemPath.EXTENSION)+"/jsx/";t.evalScript('$.evalFile("'+i+e+'")')},t.genBuildId=function(){for(var t=Math.floor(36*Math.random()).toString(36).substr(0,1),e="0000"+Math.floor(1679616*Math.random()).toString(36),i="000"+Math.floor(46656*Math.random()).toString(36),r=0,n=0;n<4;n++){var a=Math.floor(26*Math.random());r+=Math.pow(26,n)*(a+10)}return r+=Math.floor(1e6*Math.random())+Math.floor(222640*Math.random()),t+e.substr(e.length-4)+i.substr(i.length-3)+r.toString(36)},t.createDir=function(t){var e=cep.fs.stat(t);0!==e.err&&cep.fs.makedir(t)},t}();e.default=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(6),n=i(8),a=function(){function t(){}return t.createXML=function(){var t=new r.default;return t.setHead({version:"1.0",encoding:"utf-8"}),t},t.createXMLItem=function(t,e){void 0===e&&(e=0);var i=new n.default(t,e);return i},t}();e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(7),n=function(){function t(){this._head=new r.default,this._items=[]}return t.prototype.addItem=function(t){this._items.push(t)},t.prototype.setHead=function(t){for(var e in t)Object.hasOwnProperty.call(t,e)&&this._head.addAtt(e,t[e])},t.prototype.removeItem=function(t){for(var e=0;e<this._items.length;e++)if(this._items[e]===t){this._items.splice(e,1);break}},t.prototype.getString=function(){for(var t=this._head.getString(),e=0;e<this._items.length;e++)t+="\n"+this._items[e].getString();return t},t.prototype.getItem=function(t){return t>=this._items.length?null:this._items[t]},t.prototype.addChild=function(t,e){if(void 0===e&&(e=0),!(e>=this._items.length)){var i=this._items[e];i&&i.addChild(t)}},t}();e.default=n},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=i(8),a=function(t){function e(){return t.call(this,"xml",0)||this}return r(e,t),e.prototype.getString=function(){var t="<?xml",e=this._attributes;for(var i in e)Object.hasOwnProperty.call(e,i)&&(t+=" "+i+'="'+e[i]+'"');return t+="?>"},e}(n.default);e.default=a},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this._parent=null,this._title=t,this._childs=[],this._attributes={},this._layerIndex=e}return Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parent=t},enumerable:!0,configurable:!0}),t.prototype.getChilds=function(){return this._childs},t.prototype.setLayerIndex=function(t){this._layerIndex=t},t.prototype.addChild=function(t){t.setLayerIndex(this._layerIndex+1),t.parent&&t.parent.removeChild(t),t.parent=this,this._childs.push(t)},t.prototype.removeChild=function(t){for(var e=0,i=this._childs.length;e<i;e++)if(t===this._childs[e]){this._childs.splice(e,1);break}},t.prototype.addAtt=function(t,e){this._attributes[t]=e},t.prototype.addAtts=function(t){for(var e in t)Object.hasOwnProperty.call(t,e)&&(this._attributes[e]=t[e])},t.prototype.getAtts=function(){return this._attributes},t.prototype.getAtt=function(t){return this._attributes&&this._attributes[t]?this._attributes[t]:null},t.prototype.removeAtt=function(t){this._attributes[t]&&delete this._attributes[t]},t.prototype.getString=function(){var t=this.getSpace(),e=t+"<"+this._title,i=this._attributes;for(var r in i)Object.hasOwnProperty.call(i,r)&&(e+=" "+r+'="'+i[r]+'"');if(this._childs.length>0){e+=">";for(var n=0;n<this._childs.length;n++)e+="\n",e+=this._childs[n].getString();e+="\n"+t+"</"+this._title+">"}else e+="/>";return e},t.prototype.getSpace=function(){for(var t="",e=0;e<this._layerIndex;e++)t+="  ";return t},t}();e.default=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),n=function(){function t(){this._displayItem=null,this._comItem=null,this._xml=r.default.createXML(),this._displayNum=0,this.init()}return Object.defineProperty(t.prototype,"displayNum",{get:function(){return this._displayNum},enumerable:!0,configurable:!0}),t.prototype.addAtts=function(t){this._comItem.addAtts(t)},t.prototype.setSize=function(t,e){var i=t+","+e;this._comItem.addAtt("size",i)},t.prototype.addDisplayItem=function(t){this._displayItem.addChild(t),++this._displayNum},t.prototype.getString=function(){return this._xml.getString()},t.prototype.init=function(){this._comItem=r.default.createXMLItem("component"),this._displayItem=r.default.createXMLItem("displayList"),this._comItem.addChild(this._displayItem),this._xml.addItem(this._comItem)},t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),n=function(){function t(t,e,i){this._id=e.substr(0,8),this._itemIdBase=e.substr(8),this._nextItemIndex=0,this._bagName=i,this._xml=r.default.createXML(),this.init()}return Object.defineProperty(t.prototype,"itemIdBase",{get:function(){return this._itemIdBase},enumerable:!0,configurable:!0}),t.prototype.getNextItemId=function(){return this._itemIdBase+(this._nextItemIndex++).toString(36)},t.prototype.getString=function(){return this._xml.getString()},t.prototype.getAttsByKeyAndValue=function(t,e){for(var i=this._resourcesItem.getChilds(),r=0,n=i.length;r<n;r++){var a=i[r].getAtts();if(a[t]===e)return a}return null},t.prototype.addImage=function(t,e){var i=r.default.createXMLItem("image",2);i.addAtt("id",this.getNextItemId()),i.addAtt("name",t),i.addAtt("path",e),this._resourcesItem.addChild(i)},t.prototype.addComponent=function(t,e){var i=r.default.createXMLItem("component",2);i.addAtt("id",this.getNextItemId()),i.addAtt("name",t),i.addAtt("path",e),i.addAtt("exported","true"),this._resourcesItem.addChild(i)},t.prototype.getComponent=function(t){for(var e=this._resourcesItem.getChilds(),i=0,r=e.length;i<r;i++){var n=e[i].getAtt("name");if(n===t)return e[i]}return null},t.prototype.init=function(){var t={id:this._id,jpegQuality:"80",compressPNG:"true"},e=r.default.createXMLItem("packageDescription");this._resourcesItem=r.default.createXMLItem("resources");var i=r.default.createXMLItem("publish");e.addAtts(t),e.addChild(this._resourcesItem),e.addChild(i),i.addAtts({name:this._bagName}),this._xml.addItem(e)},t}();e.default=n}]);